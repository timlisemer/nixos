# Climate Control Automations
# Uses helper binary sensors for cleaner trigger logic

- id: 'tim_buro_schlafzimmer_heizung'
  alias: 'Tim Büro & Schlafzimmer Heizung'
  description: "Control Tim's office/bedroom heating based on Tim's presence, room activity, and time of day"
  triggers:
    - trigger: state
      entity_id: binary_sensor.tim_home
    - trigger: state
      entity_id: binary_sensor.buro_tim_schlafzimmer_in_use
    - trigger: state
      entity_id: binary_sensor.tim_daytime_heating_period
    - trigger: time_pattern
      hours: '/1'
  conditions: []
  actions:
    - variables:
        is_daytime: "{{ is_state('binary_sensor.tim_daytime_heating_period', 'on') }}"
        room_in_use: "{{ is_state('binary_sensor.buro_tim_schlafzimmer_in_use', 'on') }}"
        tim_home: "{{ is_state('binary_sensor.tim_home', 'on') }}"
        should_heat: '{{ room_in_use or (is_daytime and tim_home) }}'
    - if:
        - condition: template
          value_template: '{{ should_heat }}'
      then:
        - action: script.set_thermostat_active
          data:
            device_id: '8e43dd49edabad810cad3280f1bdaed2'
            entity_id: 'climate.tim_buro_schlafzimmer_heizung'
            temperature: 22
      else:
        - action: script.set_thermostat_away
          data:
            device_id: '8e43dd49edabad810cad3280f1bdaed2'
            temperature: 18
  mode: single

- id: 'kuche_wohnzimmer_heizung'
  alias: 'Küche & Wohnzimmer Heizung'
  description: 'Control kitchen/living room heating based on presence, room activity, and time of day'
  triggers:
    - trigger: state
      entity_id: binary_sensor.somebody_home
    - trigger: state
      entity_id: binary_sensor.kuche_wohnzimmer_in_use
    - trigger: state
      entity_id: binary_sensor.wohnzimmer_kuche_daytime_heating_period
    - trigger: time_pattern
      hours: '/1'
  conditions: []
  actions:
    - variables:
        is_daytime: "{{ is_state('binary_sensor.wohnzimmer_kuche_daytime_heating_period', 'on') }}"
        room_in_use: "{{ is_state('binary_sensor.kuche_wohnzimmer_in_use', 'on') }}"
        someone_home: "{{ is_state('binary_sensor.somebody_home', 'on') }}"
        should_heat: '{{ room_in_use or (is_daytime and someone_home) }}'
    - if:
        - condition: template
          value_template: '{{ should_heat }}'
      then:
        - action: script.set_thermostat_active
          data:
            device_id: 'b43a7d28a741800dded3477f78596736'
            entity_id: 'climate.wohnzimmer_heizung'
            temperature: 22
        - action: script.set_thermostat_active
          data:
            device_id: '838541bdd2f7fe50973709d68bf1707c'
            entity_id: 'climate.kuche_heizung'
            temperature: 20
      else:
        - action: script.set_thermostat_away
          data:
            device_id: 'b43a7d28a741800dded3477f78596736'
            temperature: 18
        - action: script.set_thermostat_away
          data:
            device_id: '838541bdd2f7fe50973709d68bf1707c'
            temperature: 18
  mode: single
